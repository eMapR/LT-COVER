---
title: "LT-COVER Biomass (NBCD FIA) v1"
subtitle: 'Annual 30-meter gridded biomass estimates for the conterminous United States 1984-2017'
bibliography: ../../misc/references.bib
biblio-style: ../../misc/apa
citecolor: blue
geometry: margin=1in
header-includes:
  - \usepackage{float}
  - \usepackage{subcaption}
  - \usepackage{graphicx}
  - \usepackage{caption}
  - \usepackage{hyperref}
  - \hypersetup{
      colorlinks=true,
      linkcolor=blue,
      filecolor=magenta,      
      urlcolor=blue,
    }
output: 
  pdf_document:
    citation_package: natbib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r include=FALSE}
#homeDir = 'D:/work/code_library/LT-COVER/documentation/biomass/ltc_biomass_nbcd_fia_mean_v01'
#homeDir = dirname(list.files(getwd(), '*', full.names = T)[1])
homeDir = getwd()
otherDir = normalizePath(paste0(file.path(homeDir, 'other'),'/'), winslash = '/')
figsDir = normalizePath(paste0(file.path(homeDir, 'figs'),'/'), winslash = '/')
genericDir = normalizePath(paste0(file.path(homeDir, 'figs'),'/'), winslash = '/')
```




\vspace{50px}

\begin{figure}[H]
\includegraphics{../../misc/biomass_cover.jpg}
\end{figure}

\vspace{75px}

\centerline{Robert Kennedy, Joe Hughes, Justin Braaten, Sam Hooper, Peter Clary}
\centerline{Oregon State University}
\bigbreak

\centerline{Documentation v1}
\centerline{November 3, 2018}

\pagebreak

\section{Summary}
The LT-COVER Biomass (NBCD FIA) data are 30-meter gridded annual biomass estimates for the conterminous United States (CONUS) for years 1984-2017. They are modeled after the above-ground, live, dry biomass estimates (NBCD_MZxx_FIA_ALD_biomass) provided by \citet{kellndorfer2013nacp}. The data were generated by a spatiotemporal exploratory model (STEM) \citep[][\href{https://github.com/eMapR/pystem}{code}]{hooper2018spatial} that relied on the Kellndorfer data for training and Landsat surface reflectance time series observations, along with topographic variables, as predictors. The resulting model (~80,000 models) was then applied to all years in the annual time series. To achieve prediction stability through time using a single model, the Landsat data was first fitted to spectral-temporal trends using the LandTrendr \citep[][\href{https://github.com/eMapR/LT-GEE}{code}]{kennedy2018implementation, kennedy2010detecting} segmentation algorithm. An accuracy assessment based on agreement between the reference data and the predicted data for the year 2000 (year trained on) shows that the median of median absolute error among 67 assessment zones is four Mg/ha and the median correlation coefficient is 0.87.

\section{Data Access}
Please visit \url{https://github.com/eMapR/LT-COVER} for information regarding data access options. 

\section{Metadata}
The following table (\autoref{table:metaData}) describes the original characteristics of the dataset. Note that data may be delivered with deviating charactersitics.


\begin{table}[H]
\centering
\begin{tabular}{ |l|l| } 
  \hline
  \textbf{Characteristic} & \textbf{Value} \\ 
  \hline
  Exent & Conterminous United States (CONUS) \\
  \hline
  Projection & EPSG:5070 \\
  \hline
  Projected unit & meter \\
  \hline
  Projected bounds & ulxy: (-2356060, 3172580), lrxy: (2258200, 272055) \\
  \hline
  Spatial resolution & 30 m (x), 30 m (y) \\
  \hline
  Temporal resolution & Annual \\
  \hline
  Temporal duration & 34 years (1984-2017) \\
  \hline
  Grid size & 153809 columns, 96684 rows \\
  \hline
  Nodata value & -9999 \\
  \hline
  Data type & Int16 \\
  \hline
  Data unit & Megagrams per hectare (Mg/ha) above-ground, live, dry biomass \\
  \hline
\end{tabular}
\caption{Metadata.}
\label{table:metaData}
\end{table}








\section{Methods}

\subsection{Overview}
The goal was to use 30 m spectral and topographic data to generate a model that would mimic the map of biomass created by Kellndorfer et al for the year 2000 and then apply the model to all year from 1984-2017. Variable selection was performed to reduce a total of 412 candidate predictors down to 10. A spatiotemporal exploratory model was generated from a stratified random sample of corresponding pixels in the Kellndorfer et al 2000 biomass training map and the 10 predictor variables. The model was applied to all years from 1984 to 2017 and aggregated using the median of intersecting model estimates. An accuracy assessment based on agreement between the reference data and the predicted data for the year 2000 was conducted on 67 assessment zones to reveil regional fidelity. 

\subsection{Prediction}
\subsubsection{Predictor Variables Selection}
Combinations of Landsat surface reflectance image data, derived spectral change information, and topographic variables constituted a total candidate pool of 412 variables (\autoref{table:totalPred}). Through a process of variable selection, the top ten variables were selected as the final predictor set (\autoref{table:finalPred}). The initial candidate pool included eight spectral indices, with all combinations of them defining spectral-temporal segmentation in the LandTrendr algorithm and being fitted to segmentation. For each of the spectral variables, the spectral delta from the previous year to the current year was included, as well as the number of years since the last spectral-temporal segment vertex for each segmentation-defining spectral index. These variables were generated for three seasons, spring (April 15-July 15), summer (June 15-September 15), and autumn (August 15-November 15). Additionally, elevation, aspect, topographic position index, and slope were included. The ten best variables from the total pool were selected by sequential forward floating search to find a near-optimal subset of candidate predictors. Variable performance was based on successfully characterizing land attributes (NLCD land cover, canopy cover, and impervious surface cover) from a sample of pixels drawn from 20 regions representing a spatial subset for each of the classes in the EPA level II ecoregion dataset \citep{omernik2014ecoregions}. 


\begin{table}[H]
\centering
\begin{tabular}{ |l|l|l| } 
  \hline
  \textbf{Predictor} & \textbf{Description} & \textbf{Citation} \\
  \hline
  Red$^{[1][4]}$ & Red band (0.63-0.69 $\mu$m) &  \\
  \hline
  SWIR1$^{[1][4]}$ & Shortwave infrared band (1.55-1.75 $\mu$m) & \\
  \hline
  NBR$^{[1][4]}$ & Normalized Difference Burn Ratio & \citep{key2005landscape} \\
  \hline
  NDSI$^{[1][4]}$ & Normalized Difference Snow Index & \citep{hall1995development} \\
  \hline
  NDVI$^{[1][4]}$ & Normalized Difference Vegetation Index & \citep{rouse1974monitoring}\\
  \hline
  TCB$^{[1][4]}$ & Tasseled Cap Brightness & \citep{crist1985tm} \\
  \hline
  TCG$^{[1][4]}$ & Tasseled Cap Greenness & \citep{crist1985tm} \\
  \hline
  TCW$^{[1][4]}$ & Tasseled Cap Wetness & \citep{crist1985tm} \\
  \hline
  Delta$^{[2][4]}$ & spectral difference from previous year & \\
  \hline
  Tsince$^{[3][4]}$ & Time since last vertex (years) & \\
  \hline
  Elevation & Elevation above sea level & \\
  \hline
  Slope & Topographic slope & \\
  \hline
  Aspect & Topographic aspect & \\
  \hline
  TPI & Topographic postional index & \citep{weiss2001topographic} \\ 
  \hline
\end{tabular}
\caption{Candidate predictor variables. \newline
$^{[1]}$ Used as a LandTrendr segmentation index and was also fitted to segmentation by all other indices.\newline
$^{[2]}$ Calculated for all combinations of all $^{[1]}$ predictors \newline
$^{[3]}$ Calculated only once for each $^{[1]}$ index segmented with by LandTrendr \newline
$^{[4]}$ Represented by three Landsat compossite seasons: spring (April 15-July 15), summer (June 15-September 15), and autumn (August 15-November 15).}
\label{table:totalPred}
\end{table}


\begin{table}[H]
\centering
\begin{tabular}{ |l|p{12cm}| } 
  \hline
  \textbf{Predictor} & \textbf{Description} \\ 
  \hline
  ndsi\_summer\_b3 & Landsat red band time series fitted to LandTrendr segmentation of summer NDSI composite \\
  \hline
  ndsi\_summer\_tcg & Landsat TCG time series fitted to LandTrendr segmentation of summer NDSI composite \\
  \hline
  ndsi\_autumn\_tcb & Landsat TCB time series fitted to LandTrendr segmentation of autumn NDSI composite \\
  \hline
  ndvi\_spring\_b5 & Landsat SWIR1 time series fitted to LandTrendr segmentation of spring NDVI composite \\
  \hline
  ndvi\_spring\_deltab5 & Landsat SWIR1 Delta derived from SWIR1 fitted to LandTrendr segmentation of spring NDVI composite \\
  \hline
  ndvi\_spring\_ndsi & Landsat NDSI time series fitted to LandTrendr segmentation of spring NDVI composite \\
  \hline
  tcb\_autumn\_ndsi & Landsat NDSI time series fitted to LandTrendr segmentation of autumn TCB composite \\
  \hline
  tcb\_autumn\_ndvi & Landsat NDVI time series fitted to LandTrendr segmentation of autumn TCB composite \\
  \hline
  elevation & Topographic elevation \\
  \hline
  slope & Topographic slope \\
  \hline
\end{tabular}
\caption{Final set of predictor variables.}
\label{table:finalPred}
\end{table}

\subsubsection{Predictor Data Generation}

Spectral variable generation was done on the Google Earth Engine \citep{gorelick2017google} platform. For each of the three seasons, a collection of USGS surface reflectance images \citep{masek2006landsat, vermote2016preliminary} from 1984 to 2017 was assembled. The collections included images from Thematic Mapper (TM), Enhanced Thematic Mapper Plus (ETM+), and Operational Land Imager (OLI) sensors. Each image of the collections were masked to exclude clouds, cloud shadows, and snow using the CFMASK mask \citep{zhu2015improvement}, which is provided with the surface reflectance product. Additionally, OLI image bands 2, 3, 4, 5, 6 and 7 were transformed to the spectral properties of ETM+ bands 1, 2, 3, 4, 5 and 7, respectively, using slopes and intercepts from reduced major axis regressions reported in Table 2 of \citet{roy2016characterization}. Images from within each seasonal collection were composited using a medoid approach: for a given image pixel, the medoid is the value for a given band that is numerically closest to the median of all corresponding pixels among the images considered.  

Medoid compositing was performed for each year per season collection and included images from any sensor contributing to the annual set of observations for the year being processed. The result was a single multi-band image, per year, free of clouds and cloud shadows, representing median spring, summer, and autumn season surface reflectance. From these annual medoid composites, indices from \autoref{table:finalPred} were calculated and provided as segmentation and fit-to-vertice inputs to the LandTrendr spectral-temporal segmentation algorithm \citep{kennedy2010detecting, kennedy2018implementation}. LandTrendr identifies breakpoints (referred to as vertices) in an image pixel time series between periods of relatively consistent spectral trajectory. From these breakpoints, a new time series is constructed, where each annual observation is interpolated to fit on a line segment between vertices (Figure 3). The result is an idealized, trajectory-based, time series free from noise, where each observation is placed in the context of a spectral-temporal trend. The LandTrendr parameters used can be found in \autoref{table:ltParams}



\begin{table}[H]
\centering
\begin{tabular}{ |l|l| } 
  \hline
  \textbf{Parameter} & \textbf{Value} \\ 
  \hline
  maxSegments & 6 \\
  \hline
  spikeThreshold & 0.9 \\
  \hline
  vertexCountOvershoot & 3 \\
  \hline
  preventOneYearRecovery & true \\
  \hline
  recoveryThreshold & 0.25 \\
  \hline
  pvalThreshold & 0.05 \\
  \hline
  bestModelProportion & 0.75 \\
  \hline
  minObservationsNeeded & 6 \\
  \hline
\end{tabular}
\caption{LandTrendr parameters used.}
\label{table:ltParams}
\end{table}



\subsubsection{Modeling}
A spatiotemporal exploratory model (STEM) was used to construct relationships between the biomass estimates of kellndorfer et al and the predictor variables described previously. A STEM is an ensemble of locally defined, randomly located, spatially overlapping decision trees culminating in a final prediction by aggregating over all overlapping pixels with a specified statistical function, such as the median (\autoref{fig:stem}). Both the potential spatial coordinates of the training sample and the prediction domain for each decision tree are spatially limited by a support set. The method produces a seamless broad-extent map that reflects variability at the spatial scale of each constituent support set without the need for pre-define modeling regions. The final value of each pixel was determined from a population of approximately 100 estimates  representatives (in this particular dataset) from randomly overlapping support sets.

\begin{figure}[H]
\includegraphics{../../misc/support_sets.png}
\caption{Conceptual representation of STEM: an ensemble of locally defined, randomly located, spatially overalpping decision trees culminating in a final prediction by aggregating over all overlapping pixels with a specified statistical function.}
\label{fig:stem}
\end{figure}


A stratified random sample of pixels from the kellndorfer et al 2000 map were selected according to parameters listed in \autoref{table:getSampParams}. Predictor variable values were then extracted from year 2000 for each pixel identifed in the sample. The model was then trained using parameters presented in \autoref{table:trainParams}

\begin{table}[H]
\centering
\begin{tabular}{ |l|l| }  
  \hline
  \textbf{Parameter} & \textbf{Value} \\ 
  \hline 
  bins & -1:1, 1:50, 50:100, 100:150, 150:200, 200:300, 300:400, 400:600, 600:800 \\
  \hline
  pct\_train & 1 \\
  \hline
  data\_type & continuous \\
  \hline
  n\_tiles & 15, 25 \\
  \hline
  sampling\_scheme & proportional \\
  \hline
  min\_sample & 0.03 \\
  \hline
  max\_sample & 0.3 \\
  \hline
  n\_per\_tile & 30000 \\
  \hline
\end{tabular}
\caption{Seleted STEM \textit{get\_stratified\_random\_pixels.py} parameters.}
\label{table:getSampParams}
\end{table}


\begin{table}[H]
\centering
\begin{tabular}{ |l|l| }  
  \hline
  \textbf{Parameter} & \textbf{Value} \\ 
  \hline
  cell\_size & 30000, 30000 \\ 
  \hline
  support\_size & 150000, 150000 \\ 
  \hline
  sets\_per\_cell & 4 \\ 
  \hline
  min\_obs & 500 \\ 
  \hline
  model\_type & regressor \\ 
  \hline
\end{tabular}
\caption{Seleted STEM \textit{train\_stem.py} parameters.}
\label{table:trainParams}
\end{table}


\begin{table}[H]
\centering
\begin{tabular}{ |l|l| }  
  \hline
  \textbf{Parameter} & \textbf{Value} \\ 
  \hline
  support\_size & 150000, 150000 \\ 
  \hline
  n\_tiles & 60, 90 \\ 
  \hline
\end{tabular}
\caption{Seleted STEM \textit{predict\_stem.py} parameters.}
\label{table:predictParams}
\end{table}


\subsection{Model Application}
The resulting STEM model trained from the year 2000 was applied to all years from 1984-2017. A single model applied throught time is reasonable because all of the time series data was fitted to trends using the LandTrendr spectral-temporal segmenation algorimth, which places each value in a pixel's time series along lines defined by breakpoints where durable change is statistcally recognized. This acheives a high level of prediction consistency and expectation i.e. biomass estimates are not bouncing around year-to-year because of inherent variablity in the raw surface reflectance data. Examples of other projects that have used LandTrendr fitted spectral data to apply a single model through time include: \citep{hooper2018spatial, vogeler2018extracting, kennedy2018empirical}. The following series of figures (\autoref{fig:pixelStory}, \autoref{fig:segmentation}, \autoref{fig:ftv}, \autoref{fig:tcftv}) describe the LandTrendr segmentation and time series fitting processes.

\newpage

\begin{figure}[H]
\includegraphics{../../misc/pixel_story.jpg}
\caption{Every pixel tells a story. Landsat provides a historical record of the character of landscapes. By extracting a single pixel from a time series of Landsat imagery, it is possible to recount the state and change of the features composing the 1-hectare area of a pixel through time. In this example, we analyze the history of a conifer forest pixel from an industrial forest region of the Pacific Northwest (USA) that experiences a period of relative stability, a dramatic, rapid loss of vegetation, and subsequent regeneration.}
\label{fig:pixelStory}
\end{figure}

\begin{figure}[H]
\includegraphics{../../misc/segmentation.png}
\caption{LandTrendr pixel time series segmentation. Image data is reduced to a single band or spectral index and then divided into a series of straight line segments by breakpoint (vertex) identification.}
\label{fig:segmentation}
\end{figure}

\begin{figure}[H]
\includegraphics{../../misc/seg_index_ftv.png}
\caption{Hindsight-enhanced image time series data (fit-to-vertices). Identification of time series breakpoints or vertices allows the observations between vertices to be interpolated, removing extraneous information and placing each observation in the context of the trajectory it is part of. This is useful in filling missing observations because of cloud and shadow, and makes for more consistent annual map prediction.}
\label{fig:ftv}
\end{figure}

\begin{figure}[H]
\includegraphics{../../misc/all_index_ftv.png}
\caption{A stack of spectral representations can be standardized to the segmentation structure of a single spectral band or index. Here we are demonstrating the standardization of tasseled cap brightness, greenness, and wetness to the segmentation structure of NBR. This allows us to take advantage of multi-dimensional spectral space to describe the properties of spectral epochs and breakpoints to predict land cover, change process, and transitions from a consistent perspective (NBR).}
\label{fig:tcftv}
\end{figure}

\newpage


\section{Accuracy Assessment}

An accuracy assessment comparing the pixel level agreement between the reference map and the prediction map for the corresponding year of 2000 was conducted. The assessment was broken into 67 zones \autoref{fig:zonemap} as initially defined by \citet{homer2001partitioning} for use in developing the NLCD 2001 Land Cover map \citep{homer2004development}, and modified slightly for use by Kellndorfer and the LANDFIRE program for defining modeling regions. The modified \citet{homer2001partitioning} zone map can be downloaded here \url{https://github.com/eMapR/LT-COVER/blob/master/vector/conus_mapszones_landfire.zip} and the version used in our accessment, which was clipped to the boundary of the LT-COVER data can be downloaded here \url{https://github.com/eMapR/LT-COVER/blob/master/vector/conus_mapzones_lt-cover.zip}.

Errors present in the training data could have been propagated to our maps



\begin{figure}[H]
\includegraphics{../../misc/zone_map.png}
\caption{Accuracy assessment zone map}
\label{fig:zonemap}
\end{figure}

\bigbreak

\begin{table}[H]
\centering
\begin{tabular}{ |p{1cm}|p{1cm}|p{1cm}|p{1cm}|p{1cm}|p{1cm}|p{1cm}|p{1cm}|p{1cm}|p{1cm}|p{1cm}| } 
  \hline
  \hyperref[zone1]{1} & \hyperref[zone2]{2} & \hyperref[zone3]{3} & \hyperref[zone4]{4} & \hyperref[zone5]{5} & \hyperref[zone6]{6} & \hyperref[zone7]{7} & \hyperref[zone8]{8} & \hyperref[zone9]{9} & \hyperref[zone10]{10} & \hyperref[zone12]{12} \\
  \hline
  \hyperref[zone13]{13} & \hyperref[zone14]{14} & \hyperref[zone15]{15} & \hyperref[zone16]{16} & \hyperref[zone17]{17} & \hyperref[zone18]{18} & \hyperref[zone19]{19} & \hyperref[zone20]{20} & \hyperref[zone21]{21} & \hyperref[zone22]{22} & \hyperref[zone23]{23} \\
  \hline
  \hyperref[zone24]{24} & \hyperref[zone25]{25} & \hyperref[zone26]{26} & \hyperref[zone27]{27} & \hyperref[zone28]{28} & \hyperref[zone29]{29} & \hyperref[zone30]{30} & \hyperref[zone31]{31} & \hyperref[zone32]{32} & \hyperref[zone33]{33} & \hyperref[zone34]{34} \\
  \hline
  \hyperref[zone35]{35} & \hyperref[zone36]{36} & \hyperref[zone37]{37} & \hyperref[zone38]{38} & \hyperref[zone39]{39} & \hyperref[zone40]{40} & \hyperref[zone41]{41} & \hyperref[zone42]{42} & \hyperref[zone43]{43} & \hyperref[zone44]{44} & \hyperref[zone45]{45} \\
  \hline
  \hyperref[zone46]{46} & \hyperref[zone47]{47} & \hyperref[zone48]{48} & \hyperref[zone49]{49} & \hyperref[zone50]{50} & \hyperref[zone51]{51} & \hyperref[zone52]{52} & \hyperref[zone53]{53} & \hyperref[zone54]{54} & \hyperref[zone55]{55} & \hyperref[zone56]{56} \\
  \hline
  \hyperref[zone57]{57} & \hyperref[zone58]{58} & \hyperref[zone59]{59} & \hyperref[zone60]{60} & \hyperref[zone61]{61} & \hyperref[zone62]{62} & \hyperref[zone63]{63} & \hyperref[zone64]{64} & \hyperref[zone65]{65} & \hyperref[zone66]{66} & \hyperref[zone98]{98} \\
  \hline
  \hyperref[zone99]{99} & & & & & & & & & &\\
  \hline
\end{tabular}
\caption{Zone map table. Click zones numbers to hyperlink to a specific zone's accuracy assessment.}
\label{zoneTable}
\end{table}

\newpage


\begin{table}[H]
\centering
\begin{tabular}{|l|l|l|}
\hline
 & \textbf{Zero Included} & \textbf{Zero Excluded} \\ \hline
\textbf{r} & 0.87 & 0.76 \\ \hline
\textbf{MAE} & 4 & 15 \\ \hline
\textbf{$\mu$AE} & 13.6 & 19.1 \\ \hline
\end{tabular}
\caption{Overall Accuracy of the map defined by the correlation coeffient (r), median absolute error (MAE), and mean absolute error ($\mu$AE) per map zone, reduced using median.}
\end{table}





```{r echo=FALSE, paged.print=FALSE, results='asis'}
#otherDir = 'D:/work/proj/ltviz/meta_test/other/'

stats = c('r', 'maeM', 'maeU')
descr = c('Pixel-level correlation coefficient (r)',
          'Pixel-level median absolute error (MAE)',
          paste0('Pixel-level mean absolute error (\U00B5','AE)'))

for(i in 1:length(stats)){
  cat('\\begin{figure}[H]\n')
  cat('\\centering\n')
  cat('\\begin{subfigure}[b]{0.49\\linewidth}\n')
  cat(paste0('\\includegraphics{',otherDir, stats[i],'_stat_map.png}\n'))
  cat('\\caption{Zero excluded}\n')
  cat('\\end{subfigure}\n')
  cat('\\begin{subfigure}[b]{0.49\\linewidth}\n')
  cat(paste0('\\includegraphics{',otherDir, stats[i],'0_stat_map.png}\n'))
  cat('\\caption{Zero included}\n')
  cat('\\end{subfigure}\n')
  cat(paste0('\\caption{',descr[i],' by zone - spatial distribution}\n')) #caption*
  cat('\\end{figure}\n')
  
  cat('\\begin{figure}[H]\n')
  cat('\\centering\n')
  cat('\\begin{subfigure}[b]{0.49\\linewidth}\n')
  cat(paste0('\\includegraphics{',otherDir, stats[i],'_stat_hist.pdf}\n'))
  cat('\\caption{Zero excluded}\n')
  cat('\\end{subfigure}\n')
  cat('\\begin{subfigure}[b]{0.49\\linewidth}\n')
  cat(paste0('\\includegraphics{',otherDir, stats[i],'0_stat_hist.pdf}\n'))
  cat('\\caption{Zero included}\n')
  cat('\\end{subfigure}\n')
  cat(paste0('\\caption{',descr[i],' by zone - histogram}\n')) #caption*
  cat('\\end{figure}\n')
} 
```







```{r echo=FALSE, paged.print=FALSE, results='asis'}
getZone = function(files){
  zones = c()
  for(i in 1:length(files)){
    tmp = tail(strsplit(strsplit(basename(files[i]), split="\\.")[[1]][1], '_')[[1]], n=1)
    zones[i] = tmp  
  }
  return(as.numeric(zones))
} 


#figsDir = 'D:/work/proj/ltviz/meta_test/figs'

cdf0Files = sort(list.files(figsDir, 'cdf_zero*', recursive=T, full.names=T))
cdfFiles = sort(list.files(figsDir, 'cdf_nozero*', recursive=T, full.names=T))

hist1d0Files = sort(list.files(figsDir, 'hist1d_zero*', recursive=T, full.names=T))
hist1dFiles = sort(list.files(figsDir, 'hist1d_nozero*', recursive=T, full.names=T))

hist2d0Files = sort(list.files(figsDir, 'hist2d_zero*', recursive=T, full.names=T))
hist2dFiles = sort(list.files(figsDir, 'hist2d_nozero*', recursive=T, full.names=T))

mapFiles = sort(list.files(figsDir, 'map*', recursive=T, full.names=T))

zones = getZone(cdf0Files)
zonesIndex = order(zones)
zones = zones[zonesIndex]
cdf0Files = normalizePath(cdf0Files[zonesIndex], winslash='/')
cdfFiles = normalizePath(cdfFiles[zonesIndex], winslash='/')
hist1d0Files = normalizePath(hist1d0Files[zonesIndex], winslash='/')
hist1dFiles = normalizePath(hist1dFiles[zonesIndex], winslash='/')
hist2d0Files = normalizePath(hist2d0Files[zonesIndex], winslash='/')
hist2dFiles = normalizePath(hist2dFiles[zonesIndex], winslash='/')
mapFiles = normalizePath(mapFiles[zonesIndex], winslash='/')

for(i in 1:length(cdf0Files)){
  zone = as.character(zones[i])
  cat(paste0('## Zone ',zone,'\n'))
  cat(paste0('\\label{zone',zone,'}\n'))
  
  cat('\\begin{figure}[H]\n')
  cat(paste0('\\includegraphics[width=\\textwidth]{',mapFiles[i],'}\n'))
  cat(paste0('\\caption*{Zone map (zone ',zone,')}\n'))
  cat('\\end{figure}\n')
  
  cat('\\begin{figure}[H]\n')
  cat('\\centering\n')
  cat('\\begin{subfigure}[b]{0.49\\linewidth}\n')
  cat(paste0('\\includegraphics{',hist2dFiles[i],'}\n'))
  cat('\\caption{Zero excluded}\n')
  cat('\\end{subfigure}\n')
  cat('\\begin{subfigure}[b]{0.49\\linewidth}\n')
  cat(paste0('\\includegraphics{',hist2d0Files[i],'}\n'))
  cat('\\caption{Zero included}\n')
  cat('\\end{subfigure}\n')
  cat(paste0('\\caption*{2-D frequency histogram (zone ',zone,')}\n'))
  cat('\\end{figure}\n')
  
  cat('\\begin{figure}[H]\n')
  cat('\\centering\n')
  cat('\\begin{subfigure}[b]{0.49\\linewidth}\n')
  cat(paste0('\\includegraphics{',hist1dFiles[i],'}\n'))
  cat('\\caption{Zero excluded}\n')
  cat('\\end{subfigure}\n')
  cat('\\begin{subfigure}[b]{0.49\\linewidth}\n')
  cat(paste0('\\includegraphics{',hist1d0Files[i],'}\n'))
  cat('\\caption{Zero included}\n')
  cat('\\end{subfigure}\n')
  cat(paste0('\\caption*{Ordinary frequency histogram (zone ',zone,')}\n'))
  cat('\\end{figure}\n')
  
  cat('\\begin{figure}[H]\n')
  cat('\\centering\n')
  cat('\\begin{subfigure}[b]{0.49\\linewidth}\n')
  cat(paste0('\\includegraphics{',cdfFiles[i],'}\n'))
  cat('\\caption{Zero excluded}\n')
  cat('\\end{subfigure}\n')
  cat('\\begin{subfigure}[b]{0.49\\linewidth}\n')
  cat(paste0('\\includegraphics{',cdf0Files[i],'}\n'))
  cat('\\caption{Zero included}\n')
  cat('\\end{subfigure}\n')
  cat(paste0('\\caption*{Cumulative density histogram (zone ',zone,')}\n'))
  cat('\\end{figure}\n')
  cat('\\bigbreak\n')
  cat('\\hyperref[zoneTable]{Return to zone table}\n\n')
}
```

\newpage
\addcontentsline{toc}{chapter}{References}




